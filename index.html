<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DevGirl_'s Malware</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <main id="overlay">
      <div class="end">
        <img
          class="end-gif"
          src="https://media3.giphy.com/media/oe33xf3B50fsc/giphy.gif?cid=ecf05e47orilc19fktz4xc8vr2k1igag1nw71ovcnsdn1a4v&ep=v1_gifs_search&rid=giphy.gif&ct=g"
          alt=""
        />
        <img
          class="end-text"
          src="https://media.tenor.com/K0h2WUSW4NQAAAAi/bonne-journ%C3%A8e-cute.gif"
          alt=""
        />
      </div>
    </main>

    <audio src="nyan-windows-98.mp3"></audio>
    <script src="/malware.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

      const nbRows = 32;
      const nbCols = 32;
      const nbPhases = 8;
      const malware = new Malware("#overlay", {
        nbRows,
        nbCols,
        nbPhases,
        onEnd: () => {
          const endAnimationContainer = document.querySelector(".end");
          const animationAudio = document.querySelector("audio");

          endAnimationContainer.classList.add("end-active");
          // https://www.youtube.com/watch?v=LduCza8PgyU
          // Play the music
          animationAudio.play();

          setTimeout(() => {
            // Stop and reset the music
            animationAudio.pause();
            animationAudio.currentTime = 0;
            // Remove the end animation
            endAnimationContainer.classList.remove("end-active");
            // Reset malware
            const divEnd = document.createElement("div");
            divEnd.className="end";
            divEnd.innerHTML = endAnimationContainer.innerHTML;
            malware.reset(); // l'overlay est vidé de tout, même les composants d'animation !!

            document.querySelector("#overlay").prepend(divEnd); // rebuild... he he he

          }, 20000);
        },
      });
      malware.init();

      const handleFillCell = (count) => {
        for (let i = 0; i < count; i++) {
          malware.fillCell();
        }
      }
      socket.on("channel-point", handleFillCell);
      socket.on("sub", handleFillCell);
      socket.on("cheer", handleFillCell);
    </script>
  </body>
</html>
